# Deepdown Output Format Specification  

_**Version:** 0.4_

## Purpose

This specification defines a Markdown format intended for use as input to vector stores in Retrieval-Augmented Generation (RAG) workflows. The content is **generated from Deepdown templates** and structured around **JSON Schema**, which makes it broadly compatible with OpenAPI, AsyncAPI, and any other JSON Schema-based sources.

The goal is to produce clean, structured, and AI-optimised content from formal specs — ready for embedding, chunking, and agent context injection.

---

## Structure Overview

Each file represents a **single JSON Schema unit** — an object, property, enum, complex type, or API operation. The templating system supports splitting content across multiple files based on schema components or API paths.

---

## Markdown Content Guidelines

### Headings

- `#` — Schema name or operation
- `##` — Sections like `Properties`, `Validation`, `Examples`
- `###` — Sub-properties or nested sections

### Properties

Properties of objects should be documented like this:

```markdown
### `email`

- **Type**: `string`
- **Format**: `email`
- **Required**: Yes
- **Description**: The user's email address.
```

Add constraints or extra info like:

- `enum`, `minimum`, `pattern`, `default`, `nullable`, etc.

---

## Template Format

Deepdown templates use Handlebars syntax with the `.deepdown` extension and start with a YAML frontmatter configuration:

```
---
outputPattern: api/{{@pathName}}/{{@methodName}}.md
splitOn: paths
groupBy: method
---
```

Key frontmatter options:
- `splitOn`: Specifies the path to iterate over (e.g., `paths`, `components.schemas`)
- `outputPattern`: Defines the output file pattern using variables like `{{@pathName}}`, `{{@methodName}}`, `{{@schemaName}}`
- `groupBy`: Optional grouping parameter (e.g., `method` for API operations)

The template body uses Handlebars helpers and conditionals:

```markdown
# {{uppercase methodName}} {{pathName}}

{{description}}

## Table of Contents

- [Overview](#overview)
- [API Information](#api-information)
{{#if parameters}}
- [Parameters](#parameters)
{{/if}}

## Overview

{{summary}}

## API Information

- **API**: {{spec.info.title}} (v{{spec.info.version}})
- **Endpoint**: `{{uppercase methodName}} {{pathName}}`

{{#if parameters}}
## Parameters

| Name | Located In | Required | Type | Description |
|------|------------|:--------:|------|-------------|
{{#each parameters}}
| `{{name}}` | {{in}} | {{#if required}}Yes{{else}}No{{/if}} | {{schema.type}} | {{description}} |
{{/each}}
{{/if}}
```

Standard Handlebars features:
- `{{#if}}...{{else}}...{{/if}}` for conditionals
- `{{#each}}...{{/each}}` for iteration
- `{{@key}}` for accessing the current key in an object
- Helpers like `uppercase`, `lowercase`, `json`, `includes`

---

## Suggested Sections

- **Summary**: One or two lines describing what this schema represents.
- **Properties**: For objects only — list each with type, constraints, and description.
- **Validation**: Any rules applied to inputs or fields.
- **References**: `$ref` links to other schema files/components.
- **Examples**: Short JSON blocks to show real-world use.

````markdown
## Example

```json
{
  "id": "user_abc",
  "email": "person@example.com"
}
```
````

---

## Footer Disclaimer

Each generated file **must** end with:

```markdown
---
_This Markdown file was generated using **Deepdown**, a templating format for AI-ready JSON Schema content._  
_Do not edit this file directly — update the `.deepdown` source instead._
---
```

---

## Notes

- YAML-based specs are automatically converted to JSON before parsing.
- Keep output chunks compact — ideally under 2KB for efficient vector storage.
- Avoid including any live templating syntax (`{{ }}` or logic) in the output.
- Additional frontmatter fields like `operationId`, `schemaVersion`, or `x-*` extensions are welcome.
- Templates support multiple output files through frontmatter configuration.
